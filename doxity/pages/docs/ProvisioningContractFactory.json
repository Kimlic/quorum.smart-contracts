{"fileName":"\\contracts\\ProvisioningContractFactory.sol","name":"ProvisioningContractFactory","abi":[{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"createdContracts","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"attributeName","type":"string"},{"name":"communityTokenWallet","type":"uint8"},{"name":"coOwner","type":"uint8"},{"name":"kimlicWallet","type":"uint8"},{"name":"account","type":"uint8"}],"name":"setInterestsPercent","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"tokensLockPeriod","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"fieldName","type":"string"}],"name":"getAccountInterestPercent","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"account","type":"address"},{"name":"accountFieldName","type":"string"},{"name":"key","type":"string"}],"name":"createProvisioningContract","outputs":[{"name":"createdContract","type":"address"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"fieldName","type":"string"}],"name":"getKimlicWalletInterestPercent","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"fieldName","type":"string"}],"name":"getCommunityTokenWalletInterestPercent","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"lockPeriod","type":"uint256"}],"name":"setTokensLockPeriod","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"key","type":"string"}],"name":"getProvisioningContract","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"fieldName","type":"string"}],"name":"getCoOwnerInterestPercent","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[{"name":"contextStorage","type":"address"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"}],"source":"pragma solidity ^0.4.23;\r\n\r\nimport \"./KimlicContractsContext.sol\";\r\nimport \"./ProvisioningContract.sol\";\r\nimport \"./WithKimlicContext.sol\";\r\n\r\ncontract ProvisioningContractFactory is WithKimlicContext {\r\n    /// public attributes ///\r\n    mapping(address=>bool) public createdContracts;\r\n    uint public tokensLockPeriod;\r\n    mapping(string=>address) private contracts;\r\n    \r\n    /// private attributes ///\r\n    mapping(string=>uint8) private _communityTokenWalletInterestPercent;\r\n    mapping(string=>uint8) private _kimlicWalletInterestPercent;\r\n    mapping(string=>uint8) private _accountInterestPercent;\r\n    mapping(string=>uint8) private _coOwnerInterestPercent;\r\n\r\n    /// Constructors ///\r\n    constructor (address contextStorage) public WithKimlicContext(contextStorage) {\r\n    }\r\n\r\n    /// public methods ///\r\n    function createProvisioningContract(address account, string accountFieldName, string key) \r\n            public returns(ProvisioningContract createdContract) {\r\n        \r\n        KimlicContractsContext context = getContext();\r\n        uint reward = context.getProvisioningPriceList().getPrice(accountFieldName);\r\n        uint dataIndex = context.getAccountStorageAdapter().getFieldHistoryLength(account, accountFieldName);\r\n        require(dataIndex > 0, \"Data is empty\");\r\n\r\n        createdContract = new ProvisioningContract(_storage, account, accountFieldName, dataIndex, reward);\r\n        createdContract.transferOwnership(msg.sender);\r\n        address createdContractAddress = address(createdContract);\r\n        createdContracts[createdContractAddress] = true;\r\n        contracts[key] = createdContractAddress;\r\n\r\n        context.getKimlicToken().transferFrom(msg.sender, createdContractAddress, reward);\r\n    }\r\n\r\n    function setInterestsPercent(string attributeName, uint8 communityTokenWallet, uint8 coOwner, uint8 kimlicWallet, uint8 account) public {\r\n        require((communityTokenWallet + kimlicWallet + account + coOwner) == 100);\r\n\r\n        _communityTokenWalletInterestPercent[attributeName] = communityTokenWallet;\r\n        _kimlicWalletInterestPercent[attributeName] = kimlicWallet;\r\n        _accountInterestPercent[attributeName] = account;\r\n        _coOwnerInterestPercent[attributeName] = coOwner;\r\n    }\r\n\r\n    function setTokensLockPeriod(uint lockPeriod) public {\r\n        tokensLockPeriod = lockPeriod;\r\n    }\r\n\r\n    function getProvisioningContract(string key) view public returns (address) {\r\n        return contracts[key];\r\n    }\r\n\r\n    function getCommunityTokenWalletInterestPercent(string fieldName) public view returns(uint8) {\r\n        return _communityTokenWalletInterestPercent[fieldName];\r\n    }\r\n\r\n    function getKimlicWalletInterestPercent(string fieldName) public view returns(uint8) {\r\n        return _kimlicWalletInterestPercent[fieldName];\r\n    }\r\n\r\n    function getAccountInterestPercent(string fieldName) public view returns(uint8) {\r\n        return _accountInterestPercent[fieldName];\r\n    }\r\n\r\n    function getCoOwnerInterestPercent(string fieldName) public view returns(uint8) {\r\n        return _coOwnerInterestPercent[fieldName];\r\n    }\r\n}","abiDocs":[{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"createdContracts","payable":false,"stateMutability":"view","type":"function","signature":"createdContracts(address)","signatureHash":"3b562a6d"},{"constant":false,"inputs":[{"name":"attributeName","type":"string"},{"name":"communityTokenWallet","type":"uint8"},{"name":"coOwner","type":"uint8"},{"name":"kimlicWallet","type":"uint8"},{"name":"account","type":"uint8"}],"name":"setInterestsPercent","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"setInterestsPercent(string,uint8,uint8,uint8,uint8)","signatureHash":"4efc1c5d"},{"constant":true,"inputs":[],"name":"tokensLockPeriod","payable":false,"stateMutability":"view","type":"function","signature":"tokensLockPeriod()","signatureHash":"6765df71"},{"constant":true,"inputs":[{"name":"fieldName","type":"string"}],"name":"getAccountInterestPercent","payable":false,"stateMutability":"view","type":"function","signature":"getAccountInterestPercent(string)","signatureHash":"7bea5578"},{"constant":false,"inputs":[{"name":"account","type":"address"},{"name":"accountFieldName","type":"string"},{"name":"key","type":"string"}],"name":"createProvisioningContract","payable":false,"stateMutability":"nonpayable","type":"function","notice":"public methods ///\r","signature":"createProvisioningContract(address,string,string)","signatureHash":"7c502361"},{"constant":true,"inputs":[{"name":"fieldName","type":"string"}],"name":"getKimlicWalletInterestPercent","payable":false,"stateMutability":"view","type":"function","signature":"getKimlicWalletInterestPercent(string)","signatureHash":"8bbf2bd8"},{"constant":true,"inputs":[{"name":"fieldName","type":"string"}],"name":"getCommunityTokenWalletInterestPercent","payable":false,"stateMutability":"view","type":"function","signature":"getCommunityTokenWalletInterestPercent(string)","signatureHash":"945ba30c"},{"constant":false,"inputs":[{"name":"lockPeriod","type":"uint256"}],"name":"setTokensLockPeriod","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"setTokensLockPeriod(uint256)","signatureHash":"baeaa311"},{"constant":true,"inputs":[{"name":"key","type":"string"}],"name":"getProvisioningContract","payable":false,"stateMutability":"view","type":"function","signature":"getProvisioningContract(string)","signatureHash":"c50ce9bc"},{"constant":true,"inputs":[{"name":"fieldName","type":"string"}],"name":"getCoOwnerInterestPercent","payable":false,"stateMutability":"view","type":"function","signature":"getCoOwnerInterestPercent(string)","signatureHash":"cf8d5c95"},{"inputs":[{"name":"contextStorage","type":"address"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"}]}
