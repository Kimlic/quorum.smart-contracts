{"author":"Bohdan Grytsenko\r","title":"Attestation party verification rights management\r","fileName":"\\contracts\\AttestationPartyStorageAdapter.sol","name":"AttestationPartyStorageAdapter","abi":[{"constant":false,"inputs":[{"name":"party","type":"address"},{"name":"value","type":"string"}],"name":"setBusinessArea","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"party","type":"address"},{"name":"value","type":"string"}],"name":"setDataPrivacyUrl","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"party","type":"address"}],"name":"getShortName","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"party","type":"address"}],"name":"getLegalName","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"party","type":"address"},{"name":"value","type":"string"}],"name":"setLegalResidenceCountry","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"party","type":"address"},{"name":"value","type":"string"}],"name":"setWebsite","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"party","type":"address"},{"name":"fieldName","type":"string"}],"name":"addAccessToFieldVerification","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"party","type":"address"}],"name":"getDataPrivacyUrl","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"party","type":"address"},{"name":"fieldName","type":"string"}],"name":"removeAccessToFieldVerification","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"party","type":"address"}],"name":"getLegalResidenceCountry","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"party","type":"address"}],"name":"getWebsite","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"party","type":"address"},{"name":"value","type":"string"}],"name":"setLegalName","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"party","type":"address"},{"name":"fieldName","type":"string"}],"name":"getIsFieldVerificationAllowed","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"party","type":"address"}],"name":"getBusinessArea","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"party","type":"address"},{"name":"value","type":"string"}],"name":"setShortName","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"inputs":[{"name":"contextStorage","type":"address"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"}],"source":"pragma solidity ^0.4.23;\r\n\r\n\r\nimport \"./BaseStorage.sol\";\r\nimport \"./WithKimlicContext.sol\";\r\nimport \"./KimlicContractsContext.sol\";\r\nimport \"./AttestationPartyStorage.sol\";\r\nimport \"./BasePartyStorageAdapter.sol\";\r\n\r\n/// @title Attestation party verification rights management\r\n/// @author Bohdan Grytsenko\r\n/// @notice This is layer over BaseStorage which serves as management point for set of attributes Attestation party is allowed to verify\r\ncontract AttestationPartyStorageAdapter is BasePartyStorageAdapter {\r\n\r\n    /// private attributes ///\r\n    string private constant accessKeyPart = \"IsVerificaionAllowed\";\r\n\r\n    /// constructors ///\r\n    constructor (address contextStorage) public BasePartyStorageAdapter(contextStorage) {\r\n        \r\n    }\r\n\r\n    /// @notice grants right to verify specific attribute to particular AP\r\n    /// @dev grants right to verify specific attribute to particular AP\r\n    /// @param party AP account address\r\n    /// @param fieldName attribute string code\r\n    function addAccessToFieldVerification(address party, string fieldName) public {\r\n        KimlicContractsContext context = getContext();\r\n        require(msg.sender == context.owner());\r\n        require(context.getAccountStorageAdapter().isAllowedFieldName(fieldName));\r\n\r\n        AttestationPartyStorage storageAdapter = AttestationPartyStorage(getStorage());\r\n        storageAdapter.setBool(getAllowanceKey(party, fieldName), true);\r\n    }\r\n\r\n    /// @notice checks if party has right to verify specific attribute\r\n    /// @dev checks if party has right to verify specific attribute\r\n    /// @param party AP account address\r\n    /// @param fieldName attribute string code\r\n    /// @return true if party has right, false if it has no right\r\n    function getIsFieldVerificationAllowed(address party, string fieldName) public view returns(bool) {\r\n        KimlicContractsContext context = getContext();\r\n        require(context.getAccountStorageAdapter().isAllowedFieldName(fieldName));\r\n\r\n        AttestationPartyStorage storageAdapter = AttestationPartyStorage(getStorage());\r\n        return storageAdapter.getBool(getAllowanceKey(party, fieldName));\r\n    }\r\n\r\n    /// @notice revokes right to verify specific attribute from particular AP\r\n    /// @dev revokes right to verify specific attribute from particular AP\r\n    /// @param party AP account address\r\n    /// @param fieldName attribute string code    \r\n    function removeAccessToFieldVerification(address party, string fieldName) public {\r\n        KimlicContractsContext context = getContext();\r\n        require(msg.sender == context.owner());\r\n        require(context.getAccountStorageAdapter().isAllowedFieldName(fieldName));\r\n\r\n        AttestationPartyStorage storageAdapter = AttestationPartyStorage(getStorage());\r\n        storageAdapter.deleteBool(getAllowanceKey(party, fieldName));\r\n    }\r\n\r\n    /// internal methods ///\r\n    function getAllowanceKey(address party, string fieldName) internal pure returns(bytes32) {\r\n        return keccak256(abi.encode(party, accessKeyPart, fieldName));\r\n    }\r\n\r\n    function getStorage() view internal returns (BaseStorage) {\r\n        return getContext().getAttestationPartyStorage();\r\n    }\r\n    \r\n    /// Modifiers ///\r\n}","abiDocs":[{"constant":false,"inputs":[{"name":"party","type":"address","description":"AP account address\r"},{"name":"value","type":"string","description":"business area value\r"}],"name":"setBusinessArea","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function","notice":"sets party business area\r","signature":"setBusinessArea(address,string)","signatureHash":"10f15c9b"},{"constant":false,"inputs":[{"name":"party","type":"address","description":"AP account address\r"},{"name":"value","type":"string","description":"policy url value      \r"}],"name":"setDataPrivacyUrl","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function","notice":"sets party data privacy policy url\r","signature":"setDataPrivacyUrl(address,string)","signatureHash":"1137de0c"},{"constant":true,"inputs":[{"name":"party","type":"address","description":"AP account address\r"}],"name":"getShortName","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function","return":"short name value      \r","notice":"gets party short name\r","signature":"getShortName(address)","signatureHash":"1ebd3a59"},{"constant":true,"inputs":[{"name":"party","type":"address","description":"AP account address\r"}],"name":"getLegalName","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function","return":"value legal address value    \r","notice":"gets party legal name\r","signature":"getLegalName(address)","signatureHash":"33114b37"},{"constant":false,"inputs":[{"name":"party","type":"address","description":"AP account address\r"},{"name":"value","type":"string","description":"country value    \r"}],"name":"setLegalResidenceCountry","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function","notice":"sets party legal residence country\r","signature":"setLegalResidenceCountry(address,string)","signatureHash":"3c26cea6"},{"constant":false,"inputs":[{"name":"party","type":"address","description":"AP account address\r"},{"name":"value","type":"string","description":"website address value      \r"}],"name":"setWebsite","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function","notice":"sets party website address\r","signature":"setWebsite(address,string)","signatureHash":"4cfbc0b6"},{"constant":false,"inputs":[{"name":"party","type":"address","description":"AP account address\r"},{"name":"fieldName","type":"string","description":"attribute string code\r"}],"name":"addAccessToFieldVerification","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function","details":"grants right to verify specific attribute to particular AP\r","notice":"grants right to verify specific attribute to particular AP\r","signature":"addAccessToFieldVerification(address,string)","signatureHash":"5ff96bb3"},{"constant":true,"inputs":[{"name":"party","type":"address","description":"AP account address\r"}],"name":"getDataPrivacyUrl","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function","return":"value policy url value      \r","notice":"gets party data privacy policy url\r","signature":"getDataPrivacyUrl(address)","signatureHash":"6e16634d"},{"constant":false,"inputs":[{"name":"party","type":"address","description":"AP account address\r"},{"name":"fieldName","type":"string","description":"attribute string code    \r"}],"name":"removeAccessToFieldVerification","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function","details":"revokes right to verify specific attribute from particular AP\r","notice":"revokes right to verify specific attribute from particular AP\r","signature":"removeAccessToFieldVerification(address,string)","signatureHash":"8dc6fd9d"},{"constant":true,"inputs":[{"name":"party","type":"address","description":"AP account address\r"}],"name":"getLegalResidenceCountry","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function","return":"country value      \r","notice":"gets party legal residence country\r","signature":"getLegalResidenceCountry(address)","signatureHash":"a66fb326"},{"constant":true,"inputs":[{"name":"party","type":"address","description":"AP account address\r"}],"name":"getWebsite","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function","return":"website address value     \r","notice":"gets party website address\r","signature":"getWebsite(address)","signatureHash":"c05e9dec"},{"constant":false,"inputs":[{"name":"party","type":"address","description":"AP account address\r"},{"name":"value","type":"string","description":"legal address value\r"}],"name":"setLegalName","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function","notice":"sets party legal name\r","signature":"setLegalName(address,string)","signatureHash":"d611aa61"},{"constant":true,"inputs":[{"name":"party","type":"address","description":"AP account address\r"},{"name":"fieldName","type":"string","description":"attribute string code\r"}],"name":"getIsFieldVerificationAllowed","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function","details":"checks if party has right to verify specific attribute\r","return":"true if party has right, false if it has no right\r","notice":"checks if party has right to verify specific attribute\r","signature":"getIsFieldVerificationAllowed(address,string)","signatureHash":"d7b87f95"},{"constant":true,"inputs":[{"name":"party","type":"address","description":"AP account address\r"}],"name":"getBusinessArea","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function","return":"business area value    \r","notice":"gets party business area\r","signature":"getBusinessArea(address)","signatureHash":"df864f0d"},{"constant":false,"inputs":[{"name":"party","type":"address","description":"AP account address\r"},{"name":"value","type":"string","description":"short name value    \r"}],"name":"setShortName","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function","notice":"sets party short name\r","signature":"setShortName(address,string)","signatureHash":"e8b531a2"},{"inputs":[{"name":"contextStorage","type":"address"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"}]}
